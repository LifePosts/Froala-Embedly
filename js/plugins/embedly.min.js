(function(e){"function"===typeof define&&define.amd?define(["jquery"],e):"object"===typeof module&&module.exports?module.exports=function(g,a){void 0===a&&(a="undefined"!==typeof window?require("jquery"):require("jquery")(g));e(a);return a}:e(jQuery)})(function(e){var g=/^(http|https):\/\/(([a-zA-Z0-9$\-_.+!*'(),;:&=]|%[0-9a-fA-F]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])){3})|localhost|([a-zA-Z0-9\-\u00C0-\u017F]+\.)+([a-zA-Z]{2,}))(:[0-9]+)?(\/(([a-zA-Z0-9$\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*(\/([a-zA-Z0-9$\-_.+!*'(),;:@&=]|%[0-9a-fA-F]{2})*)*)?(\?([a-zA-Z0-9$\-_.+!*'(),;:@&=\/?]|%[0-9a-fA-F]{2})*)?(\#([a-zA-Z0-9$\-_.+!*'(),;:@&=\/?]|%[0-9a-fA-F]{2})*)?)?$/;e.extend(e.FroalaEditor.POPUP_TEMPLATES,{"embedly.insert":"[_BUTTONS_][_INPUT_LAYER_]"});e.extend(e.FroalaEditor.DEFAULTS,{embedlyOptions:{},embedlyHelpText:"Paste a URL to generate code"});e.FroalaEditor.PLUGINS.embedly=function(a){function h(){var c=a.popups.get("embedly.insert"),b=c.find("ul.errorlist"),c=c.find('input.fr-link-attr[type="text"][name="href"]');b.hide();b.html("");c.val("").trigger("change")}function f(c){var b=a.popups.get("embedly.insert"),d=b.find("ul.errorlist"),b=b.find('input.fr-link-attr[type="text"][name="href"]');d.html("<li>"+c+"</li>").fadeIn();b.one("keyup",function(){d.fadeOut()})}function k(c){a.events.focus(!0);a.selection.restore();var b=e.trim(c);if(""===b)return f("The URL is invalid. Please enter a valid URL."),!1;b=b.replace(/ /g,"%20");/^https?:\/\//i.test(b)||(b="http://"+b);if(!g.test(b))return f("The URL is invalid. Please enter a valid URL."),!1;c=document.createElement("a");c.href=b;b=e("#embedly-card-area");0===b.length?(b=e("<div />").appendTo("body"),b.attr("id","embedly-card-area"),b.css("display","none")):b.empty();b.append(c);var d=embedly.card(c);d?(d.on("card.snippet",function(b){b=e(b.snippet);for(var c in a.opts.embedlyOptions)a.opts.embedlyOptions.hasOwnProperty(c)&&b.attr("data-card-"+c,a.opts.embedlyOptions[c]);a.selection.restore();a.html.insert('<span contenteditable="false" class="fr-jiv">'+b[0].outerHTML+"</span><p><br></p>");c=a.$el.find(".fr-jiv");c.removeClass("fr-jiv");a.selection.setAfter(c.parent().next().get(0));a.popups.hide("embedly.insert");return!0}),d.on("card.rendered",function(a){if("error"===a.name)return f("Cannot create a card for the url. Please check the URL you entered is correct."),!0;d.send("card.snippet")})):f("Cannot create a card for the url. Please check the URL you entered is correct.");return!1}return{showPopup:function(){if(!a.popups.get("embedly.insert")){var c="";a.opts.popupButtons&&0<a.opts.popupButtons.length&&(c=c+'<div class="fr-buttons">'+a.button.buildList(a.opts.popupButtons),c+="</div>");var b=0,d='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+a.id+'">',d=d+'<ul class="errorlist" style="display:none;"></ul>';a.opts.embedlyHelpText&&(d+='<span class="fr-small-text">'+a.language.translate(a.opts.embedlyHelpText)+"</span>");d+='<div class="fr-input-line"><input name="href" type="text" class="fr-link-attr" placeholder="URL" tabIndex="'+ ++b+'"></div>';d+='<div class="fr-action-buttons"><button class="fr-command fr-submit" data-cmd="linkEmbedlyInsert" href="#" tabIndex="'+ ++b+'" type="button">'+a.language.translate("Insert")+"</button></div></div>";a.popups.create("embedly.insert",{buttons:c,input_layer:d})}h();a.popups.setContainer("embedly.insert",a.$tb);c=a.$tb.find('.fr-command[data-cmd="embedlyBtn"]');b=c.offset().left+c.outerWidth()/2;d=c.offset().top+(a.opts.toolbarBottom?10:c.outerHeight()-10);a.popups.show("embedly.insert",b,d,c.outerHeight())},hidePopup:function(){a.popups.hide("embedly.insert")},insertCallback:function(){var c=a.popups.get("embedly.insert").find('input.fr-link-attr[type="text"][name="href"]').val(),b=e(a.original_window).scrollTop();k(c);e(a.original_window).scrollTop(b)},resetPopup:h}};e.FroalaEditor.DefineIcon("embedlyBtnIcon",{NAME:"code"});e.FroalaEditor.RegisterCommand("embedlyBtn",{title:"Embed",icon:"embedlyBtnIcon",undo:!1,focus:!0,popup:!0,refreshOnCallback:!1,callback:function(){this.popups.isVisible("embedly.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("embedly.insert")):this.embedly.showPopup()}});e.FroalaEditor.RegisterCommand("linkEmbedlyInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.embedly.insertCallback()}})});